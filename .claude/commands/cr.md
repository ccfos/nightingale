---
allowed-tools: LS, Read, WebFetch, Bash(git diff)
description: code review git diff
---
1. 在 /Users/ning/gopath/src/github.com/ccfos/nightingale 项目和  /Users/ning/gopath/src/github.com/flashcatcloud/n9e-plus 分析执行 git diff
2. 阅读本次修改的代码和相关上下文相关的代码

### 审查重点
1. **正确性与健壮性**：空指针/越界/溢出、资源泄漏、错误未处理/误处理、竞态条件、线程安全、时区/编码/边界条件。  
2. **性能与内存**：不必要分配/拷贝、N+1 I/O、低效数据结构/算法、锁竞争、阻塞点、热路径微优化、对象复用。  
3. **安全**：注入、反序列化风险、路径/命令拼接、敏感信息泄露、弱随机、SSRF/XXE/CORS/CSRF 等。  
4. **可维护性**：复杂度、命名、抽象边界、死代码、日志噪音、可测试性。  

> 若 diff 很长：请按“文件 → 函数/方法 → 变更块”分批分析，先列清单后给补丁。

### 交付格式（必须遵守）

**1) 风险清单（表格）**  
字段：`#` | `Severity`(Blocker/Critical/Major/Minor/Nit) | `类别`(Correctness/Perf/Security/…) | `位置`(file:line) | `问题摘要` | `为何是问题` | `修复思路`

**2) 关键问题详解**  
- 分点阐述，必要时附 3–10 行定位代码片段与因果分析。

**3) 性能与内存分析**  
- 指出热点路径与复杂度变化（Big-O），主要分配/拷贝点，可能的锁争用与 I/O 阻塞；给出**定量建议**（如预分配、批量 I/O、避免转换等）。

**4) 安全与并发检查**  
- 列出潜在安全点与并发/竞态隐患，给出防御性编码方案（最小改动优先）。

**5) 可观测性与回滚建议**  
- 应补充/调整的日志级别、结构化字段、指标与 tracing 埋点；灰度/回滚开关设计。

**6) 可直接应用的补丁（统一 diff，最小可行）**
~~~diff
<在此给出修复与优化补丁；可分多块>
~~~