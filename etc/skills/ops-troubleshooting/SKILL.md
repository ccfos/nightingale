---
name: ops-troubleshooting
description: "通用运维故障排查技能，提供系统性的故障诊断方法论，适用于各类告警的根因分析"
---

# 通用运维故障排查技能

## 核心方法论

### 故障排查五步法

1. **收集信息** - 了解告警详情、影响范围、发生时间
2. **快速定位** - 检查系统资源、网络、服务状态
3. **深入分析** - 查看日志、追踪调用链、分析指标
4. **关联分析** - 检查近期变更、关联告警、上下游依赖
5. **总结归因** - 确定根因、给出修复建议

### 排查优先级

按照以下顺序进行排查，快速缩小问题范围：

```
基础设施层 → 网络层 → 服务层 → 应用层 → 业务层
```

## 常见故障模式

### 1. 资源耗尽类

**症状**: CPU/内存/磁盘使用率过高

**排查要点**:
- 检查 top 进程，找出资源消耗大户
- 查看资源使用趋势，判断是突增还是渐进
- 检查是否有内存泄漏、文件句柄泄漏
- 确认是否有异常进程或恶意程序

**排查方向**: 查询 CPU/内存/磁盘相关指标

### 2. 网络连接类

**症状**: 连接超时、网络不可达、延迟高

**排查要点**:
- 检查网络连通性（ping、telnet、traceroute）
- 检查 DNS 解析是否正常
- 检查防火墙规则、安全组配置
- 查看网络带宽使用情况

**排查方向**: 查询网络探测、连接数相关指标

### 3. 服务异常类

**症状**: 服务不可用、响应慢、错误率上升

**排查要点**:
- 检查服务进程是否存活
- 检查服务端口是否监听
- 查看服务日志中的错误信息
- 检查依赖服务的健康状态

**排查方向**: 查询服务健康检查、HTTP 响应指标、日志

### 4. 配置变更类

**症状**: 发布后出现问题、配置修改后异常

**排查要点**:
- 检查近期部署记录
- 对比配置变更内容
- 查看 git 提交历史
- 检查配置中心变更记录

**排查方向**: 查询 CMDB 变更记录、部署日志

## 告警上下文分析

在分析告警时，重点关注以下信息：

### 从告警标签提取关键信息

```yaml
# 常见标签
instance: 目标实例地址
job: 采集任务名称
service: 服务名称
env: 环境（prod/staging/dev）
cluster: 集群名称
namespace: K8s 命名空间
pod: Pod 名称
```

### 从告警指标判断问题类型

| 指标前缀 | 问题类型 | 排查方向 |
|---------|---------|---------|
| node_* | 主机问题 | 系统资源、进程、磁盘 |
| container_* | 容器问题 | 容器状态、资源限制 |
| http_* | HTTP服务问题 | 接口响应、错误码 |
| mysql_* | MySQL问题 | 连接数、慢查询、锁 |
| redis_* | Redis问题 | 内存、连接、命令 |
| kafka_* | Kafka问题 | 消费延迟、分区 |

## 排查工作流

```
                    ┌─────────────────┐
                    │   收到告警      │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │ 解析告警上下文   │
                    │ (标签、指标、时间)│
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              │              │              │
     ┌────────▼────────┐ ┌───▼───┐ ┌───────▼───────┐
     │  系统资源检查    │ │ 网络  │ │  服务状态     │
     │ (CPU/内存/磁盘)  │ │ 检查  │ │  检查         │
     └────────┬────────┘ └───┬───┘ └───────┬───────┘
              │              │              │
              └──────────────┼──────────────┘
                             │
                    ┌────────▼────────┐
                    │    日志分析     │
                    │  (关键字搜索)    │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │   变更关联分析   │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │   综合分析      │
                    │   输出结论      │
                    └─────────────────┘
```

## 输出规范

排查结果应包含以下部分：

1. **问题摘要**: 一句话描述问题
2. **影响范围**: 受影响的服务、用户、功能
3. **根因分析**: 问题的根本原因
4. **证据链**: 支持结论的关键数据
5. **修复建议**: 具体的修复步骤
6. **预防措施**: 避免再次发生的建议
